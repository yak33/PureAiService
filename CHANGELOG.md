# 更新日志 (Changelog)

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [2.2.0] - 2025-10-02

### 新增 ✨
- **动态模型选择功能**
  - 所有功能页面支持动态加载和选择AI模型
  - 智能对话/文本分析/代码助手: 优先选择GLM-4.5文本模型
  - OCR识别: 优先选择GLM-4V视觉模型
  - 图片编辑: 优先选择Qwen-Image-Edit模型
  - 支持搜索过滤模型列表
  - 智能筛选适配的模型类型(文本/视觉/编辑)

- **模型缓存机制**
  - 创建 `modelCache.js` 工具实现5分钟本地缓存
  - 避免页面切换时频繁请求后端
  - 自动过期刷新机制
  - 所有页面共享同一缓存

- **统一错误信息显示**
  - 使用 `a-result` 组件替换空状态显示错误
  - 错误信息在结果区域内显示，更加直观
  - 提供"知道了"按钮关闭错误提示
  - 图片编辑敏感内容错误增加中文友好提示
  - 错误信息显示5秒后自动消失

### 修复 🐛
- 修复代码助手、OCR识别、图片编辑功能缺少model参数的问题
- 修复页面切换时短暂闪现"请先在模型管理页面配置"警告的问题
- 修复错误信息只显示通用提示而不显示详细信息的问题
- 修复模型默认选择GLM-4.5V视觉模型的问题

### 变更 🔄
- **后端 API 优化**
  - `code_assist` 函数增加 `model` 参数
  - `ocr_image` 函数增加 `model` 参数
  - `edit_image` API端点增加 `model` 参数传递
  - 所有 API 端点增加详细日志记录

- **模型选择逻辑优化**
  - 文本模型: 优先选择包含"GLM-4"且不包含"V"/"Vision"的模型
  - 视觉模型: 优先选择包含"V"/"Vision"的模型
  - 编辑模型: 优先选择包含"Edit"的模型
  - 支持降级到列表第一个可用模型

### 技术优化 ⚙️
- 创建 `frontend/src/utils/modelCache.js` 缓存工具
- 所有页面使用统一的模型加载逻辑
- 优化模型下拉框加载状态显示
- 统一错误处理逻辑，提供一致的用户体验

### 用户体验优化 🎨
- 页面切换不再闪烁警告信息
- 错误提示更加清晰和友好
- 支持搜索过滤模型列表
- 统一的视觉风格和交互方式
- 模型选择更加智能和便捷

---

## [2.1.0] - 2025-10-01

### 新增 ✨
- **动态模型管理系统**
  - 从硅基流动平台实时获取所有可用模型列表
  - 用户可自主选择并配置需要使用的模型
  - 支持按类型、子类型筛选模型
  - 支持模型名称模糊搜索
  - 一键过滤 Pro/ 开头的付费模型
  - 模型配置持久化到 `data/models_config.json`
  - 新增模型管理页面 (`/models`)
  - 所有功能页面自动从配置文件读取可用模型

- **硅基流动平台账户信息集成**
  - 导航栏实时显示账户余额和状态
  - 新增获取平台模型列表 API (`GET /api/v1/ai/platform/models`)
  - 新增获取用户账户信息 API (`GET /api/v1/ai/platform/user-info`)
  - 新增模型配置管理 API (`GET/POST /api/v1/ai/models-config`)

- **请求响应日志中间件**
  - 完整记录所有API请求参数和响应内容
  - JSON数据格式化输出，便于调试
  - 显示每个请求的处理时间
  - 通过 Request-ID 关联请求和响应
  - 响应头添加 `X-Process-Time` 和 `X-Request-ID`

- **UI/UX改进**
  - 首页模型列表滚动展示，替代单一数字显示
  - 鼠标悬停暂停滚动，方便查看
  - Logo 点击可快速返回首页
  - 添加浏览器标签页图标（渐变色AI图标）
  - 文本分析页面动态加载模型列表，支持搜索

### 变更 🔄
- **移除硬编码模型配置**
  - 删除 `app/core/siliconflow_models.py` 文件
  - 移除所有功能的默认模型设置
  - 要求用户必须先配置模型才能使用
  - 未配置模型时显示友好的错误提示

- **优化导航栏布局**
  - 移除"首页"菜单项
  - 通过 Logo 返回首页
  - 新增"模型管理"菜单项

- **环境变量配置**
  - `.env.example` 中注释掉 `DEFAULT_MODEL` 配置
  - `config.py` 中 `default_model` 默认值改为空字符串

### 修复 🐛
- 修复登录后导航栏用户信息未显示的问题
- 优化平台用户信息加载时机，在路由变化时自动刷新
- 修复模型列表 API 返回格式，适配新的配置系统

### 技术优化 ⚙️
- 创建 `ModelsConfigManager` 类统一管理模型配置
- 创建 `RequestLoggingMiddleware` 中间件记录请求日志
- 所有 AI 功能方法增加模型参数检查
- 改进错误提示信息，引导用户去模型管理页面配置

### 文档 📝
- 更新 README.md，添加动态模型管理系统说明
- 创建 CHANGELOG.md 记录版本更新
- 更新项目结构说明
- 更新特性列表

---

## [2.0.0] - 2025-09-30

### 新增 ✨
- **用户认证系统**
  - JWT Token 认证机制
  - 用户注册、登录、登出功能
  - 滑动验证码防暴力破解
  - 用户信息管理（修改昵称和密码）
  - 动态背景登录页面
  - 路由守卫，未登录自动跳转

- **AI图片编辑功能**
  - 集成 Qwen-Image-Edit-2509 模型
  - 支持基于自然语言指令的图片编辑
  - 背景更换、物体添加/移除
  - 颜色调整、风格转换
  - 迭代编辑、原图对比功能

### 变更 🔄
- 统一采用左右布局设计
- 优化未登录状态的API调用逻辑
- 使用 `httpx.AsyncClient` 替代同步调用

### 技术优化 ⚙️
- 安全日志：鉴权头脱敏
- 错误详情提取，保护API密钥安全
- 支持流式响应处理

---

## [1.0.0] - 2025-09-01

### 新增 ✨
- **核心AI功能**
  - 文本分析（摘要、情感分析、关键词提取等）
  - 代码助手（审查、优化、生成、调试等）
  - 智能对话（多轮对话）
  - OCR识别（通过视觉模型）
  - 图像描述生成

- **后端架构**
  - FastAPI 框架
  - RESTful API 设计
  - 异步处理
  - 日志管理

- **前端界面**
  - Vue 3 + Ant Design Vue
  - 响应式布局
  - 现代化设计

### 技术栈
- Python 3.11+
- FastAPI
- Vue 3
- Ant Design Vue
- 硅基流动平台 API

---

## 版本说明

- **主版本号 (Major)**: 不兼容的API变更
- **次版本号 (Minor)**: 向下兼容的功能新增
- **修订号 (Patch)**: 向下兼容的问题修复

[2.1.0]: https://github.com/yourusername/ai-service/compare/v2.0.0...v2.1.0
[2.0.0]: https://github.com/yourusername/ai-service/compare/v1.0.0...v2.0.0
[1.0.0]: https://github.com/yourusername/ai-service/releases/tag/v1.0.0
